<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebRTC Video Call - PeerJS</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      height: 100vh;
      overflow: hidden;
    }
    
    /* Landing Page */
    #landing {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
    }
    
    .landing-container {
      background: #1e293b;
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #fff;
      font-size: 28px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #cbd5e1;
      font-size: 14px;
      font-weight: 500;
    }
    
    input {
      width: 100%;
      padding: 12px;
      background: #334155;
      border: 1px solid #475569;
      border-radius: 6px;
      color: #fff;
      font-size: 14px;
    }
    
    input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    input::placeholder {
      color: #64748b;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button:hover:not(:disabled) {
      background: #2563eb;
    }
    
    button:disabled {
      background: #475569;
      cursor: not-allowed;
    }
    
    .divider {
      text-align: center;
      margin: 30px 0;
      color: #64748b;
      position: relative;
    }
    
    .divider::before,
    .divider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 45%;
      height: 1px;
      background: #475569;
    }
    
    .divider::before {
      left: 0;
    }
    
    .divider::after {
      right: 0;
    }
    
    .error {
      background: #7f1d1d;
      border: 1px solid #991b1b;
      color: #fca5a5;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }
    
    /* Room Page */
    #room {
      display: none;
      height: 100vh;
      flex-direction: column;
    }
    
    #room.active {
      display: flex;
    }
    
    .header {
      background: #1e293b;
      padding: 16px 24px;
      border-bottom: 1px solid #334155;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header-info h2 {
      font-size: 18px;
      margin-bottom: 4px;
    }
    
    .header-info p {
      font-size: 12px;
      color: #94a3b8;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
    }
    
    .header-actions button {
      width: auto;
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .video-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      padding: 16px;
      overflow-y: auto;
    }
    
    .video-tile {
      position: relative;
      background: #1e293b;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 16/9;
      min-height: 200px;
    }
    
    .video-tile video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .video-tile.placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .video-tile .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #3b82f6;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      color: #fff;
      margin-bottom: 12px;
    }
    
    .video-tile .name {
      color: #cbd5e1;
      font-size: 16px;
    }
    
    .video-tile .overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
      padding: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .video-tile .name-badge {
      color: #fff;
      font-size: 14px;
      font-weight: 500;
    }
    
    .video-tile .status-badges {
      display: flex;
      gap: 4px;
    }
    
    .video-tile .status-badge {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    .video-tile .status-badge.muted {
      background: #dc2626;
    }
    
    /* Chat Sidebar */
    .chat-sidebar {
      width: 320px;
      background: #1e293b;
      border-left: 1px solid #334155;
      display: flex;
      flex-direction: column;
    }
    
    .chat-header {
      padding: 16px;
      border-bottom: 1px solid #334155;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .chat-message {
      margin-bottom: 16px;
    }
    
    .chat-message .sender {
      font-size: 12px;
      color: #3b82f6;
      margin-bottom: 4px;
    }
    
    .chat-message .text {
      color: #e2e8f0;
      font-size: 14px;
    }
    
    .chat-input-container {
      padding: 16px;
      border-top: 1px solid #334155;
      display: flex;
      gap: 8px;
    }
    
    .chat-input-container input {
      flex: 1;
      margin: 0;
    }
    
    .chat-input-container button {
      width: auto;
      padding: 12px 24px;
    }
    
    /* Controls */
    .controls {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: #1e293b;
      padding: 12px 24px;
      border-radius: 24px;
      display: flex;
      gap: 12px;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
      border: 1px solid #334155;
    }
    
    .controls button {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      background: #334155;
    }
    
    .controls button.active {
      background: #3b82f6;
    }
    
    .controls button.muted {
      background: #dc2626;
    }
    
    .controls button.leave {
      background: #dc2626;
      margin-left: 12px;
    }
    
    .controls button:hover:not(:disabled) {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <!-- Landing Page -->
  <div id="landing">
    <div class="landing-container">
      <h1>WebRTC Video Call</h1>
      
      <div id="error" class="error"></div>
      
      <div class="form-group">
        <label for="displayName">Your Display Name</label>
        <input type="text" id="displayName" placeholder="Enter your name" maxlength="50" required>
      </div>
      
      <div class="divider">Create Room</div>
      
      <button id="createRoomBtn" onclick="createRoom()">Create New Room</button>
      
      <div class="divider">Join Room</div>
      
      <div class="form-group">
        <label for="roomId">Room ID</label>
        <input type="text" id="roomId" placeholder="Enter room ID">
      </div>
      
      <button id="joinRoomBtn" onclick="joinRoom()">Join Room</button>
    </div>
  </div>
  
  <!-- Room Page -->
  <div id="room">
    <div class="header">
      <div class="header-info">
        <h2 id="roomIdDisplay">Room: -</h2>
        <p id="roomInfo">0 / 4 participants</p>
      </div>
      <div class="header-actions">
        <button onclick="toggleChat()">Toggle Chat</button>
        <button onclick="copyRoomLink()">Copy Room Link</button>
      </div>
    </div>
    
    <div class="main-content">
      <div class="video-grid" id="videoGrid"></div>
      
      <div class="chat-sidebar" id="chatSidebar" style="display: none;">
        <div class="chat-header">
          <h3>Chat</h3>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input-container">
          <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeyPress(event)">
          <button onclick="sendChatMessage()">Send</button>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <button id="toggleAudio" onclick="toggleAudio()" title="Toggle Microphone">ðŸŽ¤</button>
      <button id="toggleVideo" onclick="toggleVideo()" title="Toggle Camera">ðŸ“¹</button>
      <button class="leave" onclick="leaveRoom()" title="Leave Room">âœ•</button>
    </div>
  </div>
  
  <!-- PeerJS Library -->
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <!-- Socket.io Library -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  
  <script>
    // ============================================
    // PEERJS VIDEO CALL APP - ULTRA SIMPLE
    // ============================================
    
    // Configuration
    const SIGNALING_SERVER = window.location.origin.includes('localhost') 
      ? 'http://localhost:3000' 
      : (window.SIGNALING_SERVER || window.location.origin);
    
    // App state
    let socket = null;
    let peer = null;
    let localStream = null;
    let roomId = null;
    let userId = null;
    let peerId = null;
    let displayName = null;
    let users = new Map(); // userId -> { userId, peerId, displayName }
    let calls = new Map(); // peerId -> PeerJS call object
    let remoteStreams = new Map(); // peerId -> MediaStream
    let videoEnabled = true;
    let audioEnabled = true;
    let chatOpen = false;
    
    // Initialize Socket.io connection
    function initSocket() {
      socket = io(SIGNALING_SERVER, {
        transports: ['websocket', 'polling'],
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionAttempts: 5,
      });
      
      socket.on('connect', () => {
        console.log('âœ… Socket connected:', socket.id);
        hideError();
      });
      
      socket.on('disconnect', (reason) => {
        console.warn('âŒ Socket disconnected:', reason);
      });
      
      socket.on('error', (error) => {
        console.error('âŒ Socket error:', error);
        showError(error.message || 'Connection error');
      });
      
      // Room events
      socket.on('user-joined', handleUserJoined);
      socket.on('user-left', handleUserLeft);
      socket.on('chat-message', handleChatMessage);
    }
    
    // CRITICAL: Get media FIRST, then initialize PeerJS
    async function getLocalMedia() {
      try {
        console.log('ðŸŽ¥ Requesting camera and microphone...');
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { width: 1280, height: 720 },
          audio: true,
        });
        
        localStream = stream;
        videoEnabled = stream.getVideoTracks()[0]?.enabled ?? true;
        audioEnabled = stream.getAudioTracks()[0]?.enabled ?? true;
        
        console.log('âœ… Got local media:', {
          video: stream.getVideoTracks().length,
          audio: stream.getAudioTracks().length,
        });
        
        return stream;
      } catch (error) {
        console.error('âŒ Failed to get media:', error);
        throw new Error('Camera/microphone access denied. Please allow access and try again.');
      }
    }
    
    // Initialize PeerJS with our peerId
    function initPeerJS(myPeerId) {
      return new Promise((resolve, reject) => {
        console.log('ðŸ”Œ Initializing PeerJS with peerId:', myPeerId);
        
        // PeerJS configuration
        peer = new Peer(myPeerId, {
          host: '0.peerjs.com', // Free PeerJS server
          port: 443,
          path: '/',
          secure: true,
          config: {
            iceServers: [
              { urls: 'stun:stun.l.google.com:19302' },
              { urls: 'stun:stun1.l.google.com:19302' },
            ],
          },
        });
        
        peer.on('open', (id) => {
          console.log('âœ… PeerJS connected, peerId:', id);
          resolve(peer);
        });
        
        peer.on('error', (error) => {
          console.error('âŒ PeerJS error:', error);
          reject(error);
        });
        
        // Handle incoming calls
        peer.on('call', (call) => {
          console.log('ðŸ“ž Received call from:', call.peer);
          
          // Answer with local stream
          if (localStream) {
            call.answer(localStream);
          } else {
            console.warn('âš ï¸ No local stream to answer call');
            // Try to get media
            getLocalMedia().then(stream => {
              call.answer(stream);
            }).catch(err => {
              console.error('âŒ Could not get media for call:', err);
            });
          }
          
          // Handle remote stream
          call.on('stream', (remoteStream) => {
            console.log('ðŸ“¥ Received remote stream from:', call.peer);
            remoteStreams.set(call.peer, remoteStream);
            updateVideoGrid();
          });
          
          call.on('close', () => {
            console.log('ðŸ“´ Call closed with:', call.peer);
            calls.delete(call.peer);
            remoteStreams.delete(call.peer);
            updateVideoGrid();
          });
          
          call.on('error', (error) => {
            console.error('âŒ Call error:', error);
          });
          
          calls.set(call.peer, call);
        });
      });
    }
    
    // Create room
    async function createRoom() {
      const nameInput = document.getElementById('displayName');
      const btn = document.getElementById('createRoomBtn');
      
      const name = nameInput.value.trim();
      if (!name) {
        showError('Please enter your display name');
        return;
      }
      
      if (!socket || !socket.connected) {
        showError('Not connected to server. Please wait...');
        return;
      }
      
      try {
        // CRITICAL: Get media FIRST
        btn.disabled = true;
        btn.textContent = 'Getting camera...';
        await getLocalMedia();
        
        // Initialize PeerJS
        btn.textContent = 'Connecting...';
        const tempPeerId = generatePeerId();
        await initPeerJS(tempPeerId);
        
        // Create room
        btn.textContent = 'Creating...';
        socket.emit('create-room', { displayName: name }, (response) => {
          if (response.error) {
            showError(response.error);
            btn.disabled = false;
            btn.textContent = 'Create New Room';
            return;
          }
          
          roomId = response.roomId;
          userId = response.userId;
          peerId = response.peerId;
          displayName = name;
          
          users.set(userId, {
            userId,
            peerId,
            displayName,
          });
          
          enterRoom();
          
          // Call existing users
          response.users.forEach(user => {
            callUser(user.peerId, user.userId);
          });
        });
      } catch (error) {
        console.error('âŒ Error creating room:', error);
        showError(error.message || 'Failed to create room');
        btn.disabled = false;
        btn.textContent = 'Create New Room';
      }
    }
    
    // Join room
    async function joinRoom() {
      const nameInput = document.getElementById('displayName');
      const roomIdInput = document.getElementById('roomId');
      const btn = document.getElementById('joinRoomBtn');
      
      const name = nameInput.value.trim();
      const room = roomIdInput.value.trim().toLowerCase();
      
      if (!name) {
        showError('Please enter your display name');
        return;
      }
      
      if (!room) {
        showError('Please enter a room ID');
        return;
      }
      
      if (!socket || !socket.connected) {
        showError('Not connected to server. Please wait...');
        return;
      }
      
      try {
        // CRITICAL: Get media FIRST
        btn.disabled = true;
        btn.textContent = 'Getting camera...';
        await getLocalMedia();
        
        // Initialize PeerJS
        btn.textContent = 'Connecting...';
        const tempPeerId = generatePeerId();
        await initPeerJS(tempPeerId);
        
        // Join room
        btn.textContent = 'Joining...';
        socket.emit('join-room', { roomId: room, displayName: name }, (response) => {
          if (response.error) {
            showError(response.error);
            btn.disabled = false;
            btn.textContent = 'Join Room';
            return;
          }
          
          roomId = response.roomId;
          userId = response.userId;
          peerId = response.peerId;
          displayName = name;
          
          users.set(userId, {
            userId,
            peerId,
            displayName,
          });
          
          // Add existing users
          response.users.forEach(user => {
            users.set(user.userId, user);
          });
          
          enterRoom();
          
          // Call ALL existing users
          response.users.forEach(user => {
            callUser(user.peerId, user.userId);
          });
        });
      } catch (error) {
        console.error('âŒ Error joining room:', error);
        showError(error.message || 'Failed to join room');
        btn.disabled = false;
        btn.textContent = 'Join Room';
      }
    }
    
    // Call a user using PeerJS
    function callUser(targetPeerId, targetUserId) {
      if (!peer || !localStream) {
        console.warn('âš ï¸ Cannot call: peer or stream not ready');
        return;
      }
      
      if (calls.has(targetPeerId)) {
        console.log('âš ï¸ Call already exists to:', targetPeerId);
        return;
      }
      
      console.log(`ðŸ“ž Calling ${targetPeerId}...`);
      
      try {
        const call = peer.call(targetPeerId, localStream);
        
        if (!call) {
          console.error('âŒ Failed to create call to:', targetPeerId);
          return;
        }
        
        // Handle remote stream
        call.on('stream', (remoteStream) => {
          console.log('ðŸ“¥ Received remote stream from:', targetPeerId);
          remoteStreams.set(targetPeerId, remoteStream);
          updateVideoGrid();
        });
        
        call.on('close', () => {
          console.log('ðŸ“´ Call closed with:', targetPeerId);
          calls.delete(targetPeerId);
          remoteStreams.delete(targetPeerId);
          updateVideoGrid();
        });
        
        call.on('error', (error) => {
          console.error('âŒ Call error with', targetPeerId, ':', error);
        });
        
        calls.set(targetPeerId, call);
      } catch (error) {
        console.error('âŒ Error calling user:', error);
      }
    }
    
    // Handle user joined
    function handleUserJoined(data) {
      console.log('ðŸ‘¤ User joined:', data);
      users.set(data.userId, {
        userId: data.userId,
        peerId: data.peerId,
        displayName: data.displayName,
      });
      
      updateRoomInfo();
      updateVideoGrid();
      
      // New user will call us, but we can also call them
      // PeerJS handles this automatically
      setTimeout(() => {
        callUser(data.peerId, data.userId);
      }, 1000); // Small delay to ensure their PeerJS is ready
    }
    
    // Handle user left
    function handleUserLeft(data) {
      console.log('ðŸ‘‹ User left:', data.userId);
      
      const user = users.get(data.userId);
      if (user) {
        // Close call if exists
        const call = calls.get(user.peerId);
        if (call) {
          call.close();
          calls.delete(user.peerId);
        }
        
        remoteStreams.delete(user.peerId);
      }
      
      users.delete(data.userId);
      updateRoomInfo();
      updateVideoGrid();
    }
    
    // Enter room
    function enterRoom() {
      document.getElementById('landing').style.display = 'none';
      document.getElementById('room').classList.add('active');
      document.getElementById('roomIdDisplay').textContent = `Room: ${roomId}`;
      
      updateRoomInfo();
      updateVideoGrid();
      
      // Reset buttons
      document.getElementById('createRoomBtn').disabled = false;
      document.getElementById('createRoomBtn').textContent = 'Create New Room';
      document.getElementById('joinRoomBtn').disabled = false;
      document.getElementById('joinRoomBtn').textContent = 'Join Room';
    }
    
    // Update video grid
    function updateVideoGrid() {
      const grid = document.getElementById('videoGrid');
      grid.innerHTML = '';
      
      // Add local user
      const localUser = users.get(userId);
      if (localUser) {
        const tile = createVideoTile(localUser, true);
        grid.appendChild(tile);
      }
      
      // Add remote users
      users.forEach((user, id) => {
        if (id !== userId) {
          const tile = createVideoTile(user, false);
          grid.appendChild(tile);
        }
      });
      
      // Fill remaining slots
      const remaining = 4 - users.size;
      for (let i = 0; i < remaining; i++) {
        const tile = document.createElement('div');
        tile.className = 'video-tile placeholder';
        tile.innerHTML = `
          <div class="avatar">+</div>
          <div class="name">Waiting for user...</div>
        `;
        grid.appendChild(tile);
      }
    }
    
    // Create video tile
    function createVideoTile(user, isLocal) {
      const tile = document.createElement('div');
      tile.className = 'video-tile';
      tile.id = `tile-${user.userId}`;
      
      const video = document.createElement('video');
      video.autoplay = true;
      video.playsInline = true;
      video.muted = isLocal; // Mute local to avoid feedback
      
      // Set stream
      if (isLocal) {
        if (localStream) {
          video.srcObject = localStream;
        }
      } else {
        const remoteStream = remoteStreams.get(user.peerId);
        if (remoteStream) {
          video.srcObject = remoteStream;
        }
      }
      
      // Overlay
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      overlay.innerHTML = `
        <div class="name-badge">${user.displayName}</div>
        <div class="status-badges">
          ${isLocal && !audioEnabled ? '<div class="status-badge muted">ðŸŽ¤</div>' : ''}
          ${isLocal && !videoEnabled ? '<div class="status-badge muted">ðŸ“¹</div>' : ''}
        </div>
      `;
      
      // If no stream, show placeholder
      if (!video.srcObject) {
        tile.classList.add('placeholder');
        tile.innerHTML = `
          <div class="avatar">${user.displayName.charAt(0).toUpperCase()}</div>
          <div class="name">${user.displayName}</div>
        `;
      } else {
        tile.appendChild(video);
        tile.appendChild(overlay);
      }
      
      return tile;
    }
    
    // Update room info
    function updateRoomInfo() {
      const info = document.getElementById('roomInfo');
      info.textContent = `${users.size} / 4 participants`;
    }
    
    // Toggle audio
    function toggleAudio() {
      if (localStream) {
        audioEnabled = !audioEnabled;
        localStream.getAudioTracks().forEach(track => {
          track.enabled = audioEnabled;
        });
        updateControls();
      }
    }
    
    // Toggle video
    function toggleVideo() {
      if (localStream) {
        videoEnabled = !videoEnabled;
        localStream.getVideoTracks().forEach(track => {
          track.enabled = videoEnabled;
        });
        updateControls();
      }
    }
    
    // Update controls
    function updateControls() {
      const audioBtn = document.getElementById('toggleAudio');
      const videoBtn = document.getElementById('toggleVideo');
      
      audioBtn.classList.toggle('muted', !audioEnabled);
      videoBtn.classList.toggle('muted', !videoEnabled);
    }
    
    // Chat functions
    function toggleChat() {
      chatOpen = !chatOpen;
      const sidebar = document.getElementById('chatSidebar');
      sidebar.style.display = chatOpen ? 'flex' : 'none';
    }
    
    function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message || !socket) return;
      
      socket.emit('chat-message', {
        roomId: roomId,
        userId: userId,
        displayName: displayName,
        message: message,
      });
      
      input.value = '';
    }
    
    function handleChatKeyPress(event) {
      if (event.key === 'Enter') {
        sendChatMessage();
      }
    }
    
    function handleChatMessage(data) {
      const container = document.getElementById('chatMessages');
      const msgDiv = document.createElement('div');
      msgDiv.className = 'chat-message';
      msgDiv.innerHTML = `
        <div class="sender">${data.displayName}</div>
        <div class="text">${data.message}</div>
      `;
      
      container.appendChild(msgDiv);
      container.scrollTop = container.scrollHeight;
    }
    
    // Copy room link
    function copyRoomLink() {
      const link = `${window.location.origin}?room=${roomId}`;
      navigator.clipboard.writeText(link).then(() => {
        alert('Room link copied to clipboard!');
      });
    }
    
    // Leave room
    function leaveRoom() {
      // Close all calls
      calls.forEach((call, peerId) => {
        call.close();
      });
      calls.clear();
      
      // Stop local stream
      if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
        localStream = null;
      }
      
      // Close PeerJS
      if (peer) {
        peer.destroy();
        peer = null;
      }
      
      // Leave socket room
      if (socket && roomId) {
        socket.emit('leave-room');
      }
      
      // Reset state
      roomId = null;
      userId = null;
      peerId = null;
      displayName = null;
      users.clear();
      remoteStreams.clear();
      videoEnabled = true;
      audioEnabled = true;
      
      // Reset UI
      document.getElementById('landing').style.display = 'flex';
      document.getElementById('room').classList.remove('active');
      document.getElementById('chatMessages').innerHTML = '';
      document.getElementById('videoGrid').innerHTML = '';
    }
    
    // Show error
    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }
    
    // Hide error
    function hideError() {
      document.getElementById('error').style.display = 'none';
    }
    
    // Generate PeerJS peer ID
    function generatePeerId() {
      return 'peer-' + Math.random().toString(36).substring(2, 15);
    }
    
    // Initialize on page load
    window.addEventListener('DOMContentLoaded', () => {
      initSocket();
      
      // Check for room in URL
      const params = new URLSearchParams(window.location.search);
      const roomParam = params.get('room');
      if (roomParam) {
        document.getElementById('roomId').value = roomParam;
      }
    });
  </script>
</body>
</html>

